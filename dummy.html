<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedded Map</title>
</head>
<body>
    <h1>Embedded Map</h1>
    <iframe 
        src="https://geo.so.ch/map/?t=default&l=&bl=hintergrundkarte_sw&c=2618500%2C1238000&s=188976" 
        width="1000" 
        height="600" 
        style="border: none;">
    </iframe>

<script>
  const frame = document.getElementById('map');
  let lastHref = '';

  // Alle 300 ms prüfen, ob sich die iFrame-URL (SPA/pushState) geändert hat
  const t = setInterval(() => {
    console.log("Hallo Welt.");
    try {
      const href = frame.contentWindow.location.href; // klappt nur bei same-origin
      console.log("href: " + href)
      if (href !== lastHref) {
        lastHref = href;
        const u = new URL(href);
        let center = u.searchParams.get('c');
        if (!center && u.hash) {
          const m = u.hash.match(/c=([^&]+)/);
          if (m) center = m[1];
        }
        if (center) {
          console.log(center);
          const url = new URL(location.href);
          url.searchParams.set('c', center);
          history.replaceState(null, '', url);
        }
      }
    } catch (e) {
      // Wenn du hier landest, ist es weiterhin cross-origin
    }
  }, 300);
</script>

</body>
</html>
